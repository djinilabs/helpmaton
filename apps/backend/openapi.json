{
  "openapi": "3.1.1",
  "info": {
    "title": "Helpmaton API",
    "version": "0.0.2",
    "description": "RESTful API for Helpmaton - AI agent workspace management and operations"
  },
  "servers": [
    {
      "url": "https://app.helpmaton.com",
      "description": "Production"
    },
    {
      "url": "http://localhost:5173",
      "description": "Local Development"
    }
  ],
  "tags": [
    {
      "name": "Workspaces",
      "description": "Workspace management operations"
    },
    {
      "name": "Workspace Members",
      "description": "Workspace member management operations"
    },
    {
      "name": "Workspace Invites",
      "description": "Workspace invite management operations"
    },
    {
      "name": "Spending Limits",
      "description": "Spending limit management for workspaces and agents"
    },
    {
      "name": "Trial Credits",
      "description": "Trial credit requests and status"
    },
    {
      "name": "Workspace Settings",
      "description": "Workspace configuration and settings"
    },
    {
      "name": "Agents",
      "description": "AI agent management"
    },
    {
      "name": "Documents",
      "description": "Document management"
    },
    {
      "name": "Channels",
      "description": "Notification channel management"
    },
    {
      "name": "Email",
      "description": "Email connection management"
    },
    {
      "name": "MCP Servers",
      "description": "MCP server management"
    },
    {
      "name": "Subscription",
      "description": "Subscription management"
    },
    {
      "name": "Auth",
      "description": "Authentication operations"
    },
    {
      "name": "Usage",
      "description": "Usage statistics"
    },
    {
      "name": "Webhooks",
      "description": "Webhook endpoints"
    },
    {
      "name": "Streams",
      "description": "Streaming endpoints"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Bearer token authentication using JWT access tokens. Use the format: Authorization: Bearer <access-token>. Access tokens are obtained via /api/user/generate-tokens or /api/user/refresh-token."
      }
    },
    "responses": {
      "Unauthorized": {
        "description": "Authentication required or invalid",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "statusCode": 401,
              "error": "Unauthorized",
              "message": "Authentication required"
            }
          }
        }
      },
      "Forbidden": {
        "description": "Insufficient permissions",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "statusCode": 403,
              "error": "Forbidden",
              "message": "Insufficient permissions"
            }
          }
        }
      },
      "BadRequest": {
        "description": "Invalid request",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "statusCode": 400,
              "error": "Bad Request",
              "message": "Invalid request parameters"
            }
          }
        }
      },
      "NotFound": {
        "description": "Resource not found",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "statusCode": 404,
              "error": "Not Found",
              "message": "Resource not found"
            }
          }
        }
      },
      "InternalServerError": {
        "description": "Internal server error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Error"
            },
            "example": {
              "statusCode": 500,
              "error": "Internal Server Error",
              "message": "An unexpected error occurred"
            }
          }
        }
      }
    },
    "schemas": {
      "Error": {
        "type": "object",
        "required": [
          "statusCode",
          "error"
        ],
        "properties": {
          "statusCode": {
            "type": "integer",
            "description": "HTTP status code"
          },
          "error": {
            "type": "string",
            "description": "Error type"
          },
          "message": {
            "type": "string",
            "description": "Error message"
          }
        }
      },
      "Workspace": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Workspace ID"
          },
          "name": {
            "type": "string",
            "description": "Workspace name"
          },
          "description": {
            "type": "string",
            "description": "Workspace description",
            "nullable": true
          },
          "permissionLevel": {
            "type": "integer",
            "description": "User's permission level in this workspace",
            "nullable": true
          },
          "creditBalance": {
            "type": "integer",
            "description": "Current credit balance in millionths"
          },
          "currency": {
            "type": "string",
            "enum": [
              "usd"
            ],
            "description": "Currency code"
          },
          "spendingLimits": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SpendingLimit"
            },
            "description": "Spending limits configuration"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Creation timestamp"
          }
        }
      },
      "WorkspacesResponse": {
        "type": "object",
        "properties": {
          "workspaces": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Workspace"
            }
          }
        }
      },
      "WorkspaceResponse": {
        "type": "object",
        "allOf": [
          {
            "$ref": "#/components/schemas/Workspace"
          }
        ]
      },
      "CreateWorkspaceRequest": {
        "type": "object",
        "required": [
          "name"
        ],
        "properties": {
          "name": {
            "type": "string",
            "description": "Workspace name"
          },
          "description": {
            "type": "string",
            "description": "Workspace description"
          },
          "currency": {
            "type": "string",
            "enum": [
              "usd"
            ],
            "description": "Currency code",
            "default": "usd"
          }
        }
      },
      "UpdateWorkspaceRequest": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Workspace name"
          },
          "description": {
            "type": "string",
            "description": "Workspace description"
          }
        }
      },
      "Agent": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "Agent ID"
          },
          "name": {
            "type": "string",
            "description": "Agent name"
          },
          "systemPrompt": {
            "type": "string",
            "description": "System prompt for the agent"
          },
          "workspaceId": {
            "type": "string",
            "description": "Workspace ID"
          },
          "clientTools": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ClientTool"
            },
            "description": "Client-side tools"
          },
          "notificationChannelId": {
            "type": "string",
            "description": "Notification channel ID",
            "nullable": true
          },
          "delegatableAgentIds": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "IDs of agents that can be delegated to"
          },
          "enabledMcpServerIds": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "IDs of enabled MCP servers"
          },
          "enableMemorySearch": {
            "type": "boolean",
            "description": "Enable the memory search tool for this agent"
          },
          "enableSearchDocuments": {
            "type": "boolean",
            "description": "Enable the document search tool for this agent"
          },
          "enableSendEmail": {
            "type": "boolean",
            "description": "Enable the email sending tool for this agent (requires workspace email connection)"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Creation timestamp"
          }
        }
      },
      "ClientTool": {
        "type": "object",
        "required": [
          "name",
          "description",
          "parameters"
        ],
        "properties": {
          "name": {
            "type": "string",
            "description": "Tool name (must be valid JavaScript identifier)"
          },
          "description": {
            "type": "string",
            "description": "Tool description"
          },
          "parameters": {
            "type": "object",
            "description": "JSON Schema for tool parameters",
            "additionalProperties": true
          }
        }
      },
      "AgentsResponse": {
        "type": "object",
        "properties": {
          "agents": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Agent"
            }
          }
        }
      },
      "AgentResponse": {
        "type": "object",
        "allOf": [
          {
            "$ref": "#/components/schemas/Agent"
          }
        ]
      },
      "CreateAgentRequest": {
        "type": "object",
        "required": [
          "name",
          "systemPrompt"
        ],
        "properties": {
          "name": {
            "type": "string",
            "description": "Agent name"
          },
          "systemPrompt": {
            "type": "string",
            "description": "System prompt for the agent"
          },
          "clientTools": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ClientTool"
            },
            "description": "Client-side tools"
          },
          "notificationChannelId": {
            "type": "string",
            "description": "Notification channel ID"
          },
          "delegatableAgentIds": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "IDs of agents that can be delegated to"
          },
          "enabledMcpServerIds": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "IDs of enabled MCP servers"
          },
          "enableMemorySearch": {
            "type": "boolean",
            "description": "Enable the memory search tool for this agent"
          },
          "enableSearchDocuments": {
            "type": "boolean",
            "description": "Enable the document search tool for this agent"
          },
          "enableSendEmail": {
            "type": "boolean",
            "description": "Enable the email sending tool for this agent (requires workspace email connection)"
          }
        }
      },
      "UpdateAgentRequest": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Agent name"
          },
          "systemPrompt": {
            "type": "string",
            "description": "System prompt for the agent"
          },
          "clientTools": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ClientTool"
            },
            "description": "Client-side tools"
          },
          "notificationChannelId": {
            "type": "string",
            "description": "Notification channel ID",
            "nullable": true
          },
          "delegatableAgentIds": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "IDs of agents that can be delegated to"
          },
          "enabledMcpServerIds": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "IDs of enabled MCP servers"
          },
          "enableMemorySearch": {
            "type": "boolean",
            "description": "Enable the memory search tool for this agent"
          },
          "enableSearchDocuments": {
            "type": "boolean",
            "description": "Enable the document search tool for this agent"
          },
          "enableSendEmail": {
            "type": "boolean",
            "description": "Enable the email sending tool for this agent (requires workspace email connection)"
          }
        }
      },
      "SpendingLimit": {
        "type": "object",
        "properties": {
          "amount": {
            "type": "integer",
            "description": "Limit amount in millionths"
          },
          "currency": {
            "type": "string",
            "enum": [
              "usd"
            ],
            "description": "Currency code"
          },
          "period": {
            "type": "string",
            "enum": [
              "daily",
              "weekly",
              "monthly"
            ],
            "description": "Time period"
          }
        }
      },
      "UsageResponse": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string",
            "description": "User ID"
          },
          "currency": {
            "type": "string",
            "enum": [
              "usd"
            ],
            "description": "Currency code"
          },
          "startDate": {
            "type": "string",
            "format": "date",
            "description": "Start date (YYYY-MM-DD)"
          },
          "endDate": {
            "type": "string",
            "format": "date",
            "description": "End date (YYYY-MM-DD)"
          },
          "workspaceCount": {
            "type": "integer",
            "description": "Number of workspaces"
          },
          "stats": {
            "type": "object",
            "properties": {
              "inputTokens": {
                "type": "integer",
                "description": "Total input tokens"
              },
              "outputTokens": {
                "type": "integer",
                "description": "Total output tokens"
              },
              "totalTokens": {
                "type": "integer",
                "description": "Total tokens"
              },
              "cost": {
                "type": "integer",
                "description": "Total cost in specified currency (millionths)"
              },
              "byModel": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "model": {
                      "type": "string"
                    },
                    "inputTokens": {
                      "type": "integer"
                    },
                    "outputTokens": {
                      "type": "integer"
                    },
                    "totalTokens": {
                      "type": "integer"
                    },
                    "cost": {
                      "type": "number"
                    }
                  }
                }
              },
              "byProvider": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "provider": {
                      "type": "string"
                    },
                    "inputTokens": {
                      "type": "integer"
                    },
                    "outputTokens": {
                      "type": "integer"
                    },
                    "totalTokens": {
                      "type": "integer"
                    },
                    "cost": {
                      "type": "number"
                    }
                  }
                }
              },
              "byByok": {
                "type": "object",
                "properties": {
                  "byok": {
                    "type": "object",
                    "properties": {
                      "inputTokens": {
                        "type": "integer"
                      },
                      "outputTokens": {
                        "type": "integer"
                      },
                      "totalTokens": {
                        "type": "integer"
                      },
                      "cost": {
                        "type": "number"
                      }
                    }
                  },
                  "platform": {
                    "type": "object",
                    "properties": {
                      "inputTokens": {
                        "type": "integer"
                      },
                      "outputTokens": {
                        "type": "integer"
                      },
                      "totalTokens": {
                        "type": "integer"
                      },
                      "cost": {
                        "type": "number"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "ModelsResponse": {
        "type": "object",
        "additionalProperties": {
          "type": "object",
          "properties": {
            "models": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "defaultModel": {
              "type": "string"
            }
          }
        }
      },
      "GeneratePromptRequest": {
        "type": "object",
        "required": [
          "goal"
        ],
        "properties": {
          "goal": {
            "type": "string",
            "description": "Goal description for the agent"
          },
          "agentId": {
            "type": "string",
            "description": "Optional agent ID for editing existing agent"
          }
        }
      },
      "GeneratePromptResponse": {
        "type": "object",
        "properties": {
          "prompt": {
            "type": "string",
            "description": "Generated system prompt"
          }
        }
      }
    }
  },
  "paths": {
    "/api/workspaces/{workspaceId}": {
      "put": {
        "summary": "Update workspace",
        "description": "Updates workspace name and description. Requires WRITE permission or higher. Trial-related fields cannot be modified through this endpoint.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateWorkspaceRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Workspace updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Workspace"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "updatedAt": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Workspace not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "Get workspace by ID",
        "description": "Returns detailed information for a specific workspace including name, description, credit balance, currency, spending limits, permission level, and Google API key status. Requires READ permission or higher.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Workspace details",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Workspace"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "apiKeys": {
                          "type": "object",
                          "description": "API key status for supported providers (only OpenRouter is supported for BYOK)",
                          "properties": {
                            "openrouter": {
                              "type": "boolean",
                              "description": "Whether workspace has an OpenRouter API key configured"
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Workspace not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete workspace",
        "description": "Permanently deletes a workspace and all associated permissions, members, and resources. This action cannot be undone. Requires OWNER permission. All permission records for the workspace are also deleted.",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Workspace deleted successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Workspace not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/spending-limits/{timeFrame}": {
      "put": {
        "summary": "Update workspace spending limit",
        "description": "Updates the amount for an existing spending limit for a specific time frame (daily, weekly, or monthly). The time frame must already exist. Requires WRITE permission or higher.",
        "tags": [
          "Spending Limits"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "timeFrame",
            "in": "path",
            "required": true,
            "description": "Time frame for the spending limit",
            "schema": {
              "type": "string",
              "enum": [
                "daily",
                "weekly",
                "monthly"
              ]
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "amount"
                ],
                "properties": {
                  "amount": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Spending limit amount"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Workspace with updated spending limits",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Workspace"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "updatedAt": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete workspace spending limit",
        "description": "Removes a spending limit for a specific time frame (daily, weekly, or monthly). After deletion, there will be no limit for that time frame. Requires WRITE permission or higher.",
        "tags": [
          "Spending Limits"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "timeFrame",
            "in": "path",
            "required": true,
            "description": "Time frame for the spending limit",
            "schema": {
              "type": "string",
              "enum": [
                "daily",
                "weekly",
                "monthly"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Workspace with updated spending limits",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Workspace"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "updatedAt": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/members/{userId}": {
      "put": {
        "summary": "Update workspace member permission",
        "description": "Updates a member's permission level (1=READ, 2=WRITE, 3=OWNER). You cannot grant a permission level higher than your own. For example, a WRITE user cannot grant OWNER permissions. Requires WRITE permission or higher.",
        "tags": [
          "Workspace Members"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "description": "User ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "permissionLevel"
                ],
                "properties": {
                  "permissionLevel": {
                    "type": "integer",
                    "enum": [
                      1,
                      2,
                      3
                    ],
                    "description": "Permission level (1=READ, 2=WRITE, 3=OWNER)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Member permission updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "userId": {
                      "type": "string"
                    },
                    "userRef": {
                      "type": "string"
                    },
                    "permissionLevel": {
                      "type": "integer"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Workspace not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Remove workspace member",
        "description": "Removes a user from a workspace, revoking all their permissions. Cannot remove the last owner - a workspace must have at least one owner. This action cannot be undone. Requires OWNER permission.",
        "tags": [
          "Workspace Members"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "description": "User ID to remove",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Member removed successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Workspace or member not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/documents/{documentId}": {
      "put": {
        "summary": "Update workspace document",
        "description": "Updates document content, name, or folder location. Supports both JSON content and file uploads.",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "documentId",
            "in": "path",
            "required": true,
            "description": "Document ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "File to upload (max 10MB)"
                  },
                  "name": {
                    "type": "string",
                    "description": "New document name"
                  },
                  "folderPath": {
                    "type": "string",
                    "description": "New folder path"
                  }
                }
              }
            },
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "content": {
                    "type": "string",
                    "description": "New document content (text)"
                  },
                  "name": {
                    "type": "string",
                    "description": "New document name"
                  },
                  "folderPath": {
                    "type": "string",
                    "description": "New folder path"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Document updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "filename": {
                      "type": "string"
                    },
                    "folderPath": {
                      "type": "string"
                    },
                    "contentType": {
                      "type": "string"
                    },
                    "size": {
                      "type": "integer"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Document not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "Get workspace document",
        "description": "Returns document content and metadata",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "documentId",
            "in": "path",
            "required": true,
            "description": "Document ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Document content and metadata",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "filename": {
                      "type": "string"
                    },
                    "folderPath": {
                      "type": "string"
                    },
                    "contentType": {
                      "type": "string"
                    },
                    "size": {
                      "type": "integer"
                    },
                    "content": {
                      "type": "string",
                      "description": "Document content as text"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Document not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete workspace document",
        "description": "Deletes a document from the workspace and S3 storage",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "documentId",
            "in": "path",
            "required": true,
            "description": "Document ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Document deleted successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Document not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/channels/{channelId}": {
      "put": {
        "summary": "Update workspace channel",
        "description": "Updates channel name or configuration",
        "tags": [
          "Channels"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "channelId",
            "in": "path",
            "required": true,
            "description": "Channel ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Channel name"
                  },
                  "config": {
                    "type": "object",
                    "description": "Channel configuration (merged with existing config)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Channel updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Channel not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "Get workspace channel",
        "description": "Returns details for a specific notification channel (without sensitive config)",
        "tags": [
          "Channels"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "channelId",
            "in": "path",
            "required": true,
            "description": "Channel ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Channel details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string",
                      "description": "Channel type (e.g., discord, slack)"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Channel not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete workspace channel",
        "description": "Deletes a notification channel. Cannot delete if any agents are using it.",
        "tags": [
          "Channels"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "channelId",
            "in": "path",
            "required": true,
            "description": "Channel ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Channel deleted successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Channel not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/api-key": {
      "put": {
        "summary": "Update workspace API key",
        "description": "Creates or updates an API key for a workspace for the specified provider. The API key is used for LLM provider integration. Pass an empty string to delete the key. The key value is stored securely and never returned in API responses. Requires WRITE permission or higher.",
        "tags": [
          "Workspace Settings"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "key",
                  "provider"
                ],
                "properties": {
                  "key": {
                    "type": "string",
                    "description": "OpenRouter API key. Pass empty string to delete."
                  },
                  "provider": {
                    "type": "string",
                    "enum": [
                      "openrouter"
                    ],
                    "description": "LLM provider name (only openrouter is supported for BYOK)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "API key updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          },
          "204": {
            "description": "API key deleted successfully (when key is empty string)"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "Get workspace API key status",
        "description": "Returns whether the workspace has an API key configured for the specified provider. This is a boolean status check - the actual key value is never returned for security reasons. Requires READ permission or higher.",
        "tags": [
          "Workspace Settings"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "provider",
            "in": "query",
            "required": true,
            "description": "LLM provider name (only openrouter is supported for BYOK)",
            "schema": {
              "type": "string",
              "enum": [
                "openrouter"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "API key status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "hasKey": {
                      "type": "boolean",
                      "description": "Whether workspace has an API key configured for the specified provider"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete workspace API key",
        "description": "Permanently deletes the API key for a workspace for the specified provider. After deletion, the provider's services integration will no longer work until a new key is configured. This action cannot be undone. Requires WRITE permission or higher.",
        "tags": [
          "Workspace Settings"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "provider",
            "in": "query",
            "required": true,
            "description": "LLM provider name (only openrouter is supported for BYOK)",
            "schema": {
              "type": "string",
              "enum": [
                "openrouter"
              ]
            }
          }
        ],
        "responses": {
          "204": {
            "description": "API key deleted successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}": {
      "put": {
        "summary": "Update workspace agent",
        "description": "Updates agent configuration. Validates delegation chains to prevent circular references.",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateAgentRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Agent updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Agent"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "spendingLimits": {
                          "type": "array",
                          "items": {
                            "type": "object"
                          }
                        },
                        "temperature": {
                          "type": "number",
                          "nullable": true
                        },
                        "topP": {
                          "type": "number",
                          "nullable": true
                        },
                        "topK": {
                          "type": "integer",
                          "nullable": true
                        },
                        "maxOutputTokens": {
                          "type": "integer",
                          "nullable": true
                        },
                        "stopSequences": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "nullable": true
                        },
                        "maxToolRoundtrips": {
                          "type": "integer",
                          "nullable": true
                        },
                        "updatedAt": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent or related resource not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "Get workspace agent",
        "description": "Returns details for a specific agent",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Agent details",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Agent"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "spendingLimits": {
                          "type": "array",
                          "items": {
                            "type": "object"
                          }
                        },
                        "temperature": {
                          "type": "number",
                          "nullable": true
                        },
                        "topP": {
                          "type": "number",
                          "nullable": true
                        },
                        "topK": {
                          "type": "integer",
                          "nullable": true
                        },
                        "maxOutputTokens": {
                          "type": "integer",
                          "nullable": true
                        },
                        "stopSequences": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "nullable": true
                        },
                        "maxToolRoundtrips": {
                          "type": "integer",
                          "nullable": true
                        },
                        "updatedAt": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete workspace agent",
        "description": "Deletes an agent from the workspace",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Agent deleted successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/stream-servers": {
      "put": {
        "summary": "Update agent stream server configuration",
        "description": "Updates allowed CORS origins for an agent's stream server",
        "tags": [
          "Agents",
          "Streams"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "allowedOrigins"
                ],
                "properties": {
                  "allowedOrigins": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Allowed CORS origins (use '*' for all or specific URLs)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Stream server configuration updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "allowedOrigins": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "post": {
        "summary": "Create agent stream server configuration",
        "description": "Creates stream server configuration for an agent with allowed CORS origins",
        "tags": [
          "Agents",
          "Streams"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "allowedOrigins"
                ],
                "properties": {
                  "allowedOrigins": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Allowed CORS origins (use '*' for all or specific URLs)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Stream server configuration created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "secret": {
                      "type": "string",
                      "description": "Stream server secret for authentication"
                    },
                    "allowedOrigins": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "Get agent stream server configuration",
        "description": "Returns stream server configuration for an agent including secret and allowed origins",
        "tags": [
          "Agents",
          "Streams"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Stream server configuration",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "secret": {
                      "type": "string",
                      "description": "Stream server secret for authentication"
                    },
                    "allowedOrigins": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Allowed CORS origins"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "404": {
            "description": "Stream server configuration not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete agent stream server configuration",
        "description": "Deletes stream server configuration for an agent",
        "tags": [
          "Agents",
          "Streams"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Stream server configuration deleted successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/mcp-servers/{serverId}": {
      "put": {
        "summary": "Update workspace MCP server",
        "description": "Updates MCP server configuration",
        "tags": [
          "MCP Servers"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "serverId",
            "in": "path",
            "required": true,
            "description": "MCP server ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "url": {
                    "type": "string",
                    "format": "uri"
                  },
                  "authType": {
                    "type": "string",
                    "enum": [
                      "none",
                      "header",
                      "basic"
                    ]
                  },
                  "config": {
                    "type": "object",
                    "description": "Authentication configuration"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "MCP server updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "url": {
                      "type": "string"
                    },
                    "authType": {
                      "type": "string"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "MCP server not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "Get workspace MCP server",
        "description": "Returns details for a specific MCP server (without sensitive config)",
        "tags": [
          "MCP Servers"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "serverId",
            "in": "path",
            "required": true,
            "description": "MCP server ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "MCP server details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "url": {
                      "type": "string",
                      "description": "MCP server URL"
                    },
                    "authType": {
                      "type": "string",
                      "description": "Authentication type"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "MCP server not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete workspace MCP server",
        "description": "Deletes an MCP server. Cannot delete if any agents are using it.",
        "tags": [
          "MCP Servers"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "serverId",
            "in": "path",
            "required": true,
            "description": "MCP server ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "MCP server deleted successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "MCP server not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/email-connection": {
      "put": {
        "summary": "Update workspace email connection",
        "description": "Updates email connection name or configuration",
        "tags": [
          "Email"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Connection name"
                  },
                  "config": {
                    "type": "object",
                    "description": "Connection configuration (merged with existing)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Email connection updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Email connection not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "post": {
        "summary": "Create or update workspace email connection",
        "description": "Creates a new email connection or updates existing one for a workspace",
        "tags": [
          "Email"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "type",
                  "name",
                  "config"
                ],
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "gmail",
                      "outlook",
                      "smtp"
                    ],
                    "description": "Email connection type"
                  },
                  "name": {
                    "type": "string",
                    "description": "Connection name"
                  },
                  "config": {
                    "type": "object",
                    "description": "Connection-specific configuration",
                    "properties": {
                      "host": {
                        "type": "string",
                        "description": "SMTP host (required for smtp type)"
                      },
                      "port": {
                        "type": "integer",
                        "description": "SMTP port (required for smtp type)"
                      },
                      "secure": {
                        "type": "boolean",
                        "description": "Use secure connection (required for smtp type)"
                      },
                      "username": {
                        "type": "string",
                        "description": "SMTP username (required for smtp type)"
                      },
                      "password": {
                        "type": "string",
                        "description": "SMTP password (required for smtp type)"
                      },
                      "fromEmail": {
                        "type": "string",
                        "description": "From email address (required for smtp type)"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Email connection updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "201": {
            "description": "Email connection created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "Get workspace email connection",
        "description": "Returns email connection details for a workspace (without sensitive config)",
        "tags": [
          "Email"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Email connection details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string",
                      "description": "Email connection type"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Email connection not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete workspace email connection",
        "description": "Deletes the email connection for a workspace",
        "tags": [
          "Email"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Email connection deleted successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Email connection not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/spending-limits/{timeFrame}": {
      "put": {
        "summary": "Update agent spending limit",
        "description": "Updates the amount for an existing spending limit for a specific agent and time frame (daily, weekly, or monthly). The time frame must already exist. Requires WRITE permission or higher.",
        "tags": [
          "Spending Limits"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "timeFrame",
            "in": "path",
            "required": true,
            "description": "Time frame for the spending limit",
            "schema": {
              "type": "string",
              "enum": [
                "daily",
                "weekly",
                "monthly"
              ]
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "amount"
                ],
                "properties": {
                  "amount": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Spending limit amount"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Agent with updated spending limits",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "systemPrompt": {
                      "type": "string"
                    },
                    "notificationChannelId": {
                      "type": "string",
                      "nullable": true
                    },
                    "spendingLimits": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "delete": {
        "summary": "Delete agent spending limit",
        "description": "Removes a spending limit for a specific agent and time frame (daily, weekly, or monthly). After deletion, there will be no agent-level limit for that time frame, but workspace-level limits still apply. Requires WRITE permission or higher.",
        "tags": [
          "Spending Limits"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "timeFrame",
            "in": "path",
            "required": true,
            "description": "Time frame for the spending limit",
            "schema": {
              "type": "string",
              "enum": [
                "daily",
                "weekly",
                "monthly"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Agent with updated spending limits",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "systemPrompt": {
                      "type": "string"
                    },
                    "notificationChannelId": {
                      "type": "string",
                      "nullable": true
                    },
                    "spendingLimits": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces": {
      "post": {
        "summary": "Create a new workspace",
        "description": "Creates a new workspace for the authenticated user",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateWorkspaceRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Workspace created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WorkspaceResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "List all workspaces",
        "description": "Returns all workspaces the authenticated user has access to",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of workspaces",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WorkspacesResponse"
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/spending-limits": {
      "post": {
        "summary": "Create workspace spending limit",
        "description": "Creates a spending limit for a workspace to control costs over a specific time period (daily, weekly, or monthly). When the limit is reached, operations that would exceed it will be blocked. Multiple limits can be set for different time frames. Requires WRITE permission or higher.",
        "tags": [
          "Spending Limits"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "timeFrame",
                  "amount"
                ],
                "properties": {
                  "timeFrame": {
                    "type": "string",
                    "enum": [
                      "daily",
                      "weekly",
                      "monthly"
                    ],
                    "description": "Time period for the spending limit"
                  },
                  "amount": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Spending limit amount"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Workspace with updated spending limits",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/Workspace"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "updatedAt": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/members": {
      "post": {
        "summary": "Add workspace member",
        "description": "Adds an existing user to a workspace with the specified permission level (1=READ, 2=WRITE, 3=OWNER). Defaults to READ if not specified. Requires WRITE permission or higher. The user must already have an account in the system.",
        "tags": [
          "Workspace Members"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "userId"
                ],
                "properties": {
                  "userId": {
                    "type": "string",
                    "description": "User ID to add to workspace"
                  },
                  "permissionLevel": {
                    "type": "integer",
                    "enum": [
                      1,
                      2,
                      3
                    ],
                    "description": "Permission level (1=READ, 2=WRITE, 3=OWNER). Defaults to 1.",
                    "default": 1
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Member added successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "userId": {
                      "type": "string"
                    },
                    "userRef": {
                      "type": "string"
                    },
                    "permissionLevel": {
                      "type": "integer"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Workspace not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "List workspace members",
        "description": "Returns all members of a workspace with their permission levels (READ, WRITE, or OWNER), user IDs, email addresses, and join dates. Requires READ permission or higher.",
        "tags": [
          "Workspace Members"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of workspace members",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "members": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "userId": {
                            "type": "string"
                          },
                          "userRef": {
                            "type": "string"
                          },
                          "email": {
                            "type": "string"
                          },
                          "permissionLevel": {
                            "type": "integer",
                            "description": "Permission level (READ, WRITE, or OWNER)"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/members/invite": {
      "post": {
        "summary": "Create workspace invite",
        "description": "Creates and sends an email invite to join a workspace. The invite includes a permission level (1=READ, 2=WRITE, 3=OWNER) and expires after a set period. The invite email is sent automatically. Requires OWNER permission. The invited user must be within the subscription's user limit.",
        "tags": [
          "Workspace Invites"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email address to invite"
                  },
                  "permissionLevel": {
                    "type": "integer",
                    "enum": [
                      1,
                      2,
                      3
                    ],
                    "description": "Permission level (1=READ, 2=WRITE, 3=OWNER). Defaults to 1.",
                    "default": 1
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Invite created and sent successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "inviteId": {
                      "type": "string"
                    },
                    "email": {
                      "type": "string"
                    },
                    "permissionLevel": {
                      "type": "integer"
                    },
                    "expiresAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Workspace not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/integrations": {
      "post": {
        "summary": "Create a new bot integration",
        "description": "Creates a new Slack or Discord bot integration for an agent",
        "tags": [
          "Integrations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "platform",
                  "name",
                  "agentId",
                  "config"
                ],
                "properties": {
                  "platform": {
                    "type": "string",
                    "enum": [
                      "slack",
                      "discord"
                    ],
                    "description": "Platform type"
                  },
                  "name": {
                    "type": "string",
                    "description": "Integration name"
                  },
                  "agentId": {
                    "type": "string",
                    "description": "Agent ID to connect to"
                  },
                  "config": {
                    "type": "object",
                    "description": "Platform-specific configuration (encrypted)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Integration created successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          }
        }
      },
      "get": {
        "summary": "List bot integrations",
        "description": "Lists all bot integrations for a workspace",
        "tags": [
          "Integrations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/workspaces/{workspaceId}/integrations/slack/manifest": {
      "post": {
        "summary": "Generate Slack app manifest",
        "description": "Generates a Slack app manifest JSON with pre-filled webhook URL",
        "tags": [
          "Integrations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/workspaces/{workspaceId}/integrations/{integrationId}/discord-command": {
      "post": {
        "summary": "Register a Discord slash command",
        "description": "Creates or updates a Discord slash command for a bot integration",
        "tags": [
          "Integrations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "integrationId",
            "in": "path",
            "required": true,
            "description": "Integration ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "commandName"
                ],
                "properties": {
                  "commandName": {
                    "type": "string",
                    "description": "The name of the command (e.g., \"chat\")"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Command registered successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/documents": {
      "post": {
        "summary": "Upload workspace documents",
        "description": "Uploads one or more documents (files or text) to a workspace. Supports up to 50 files. Allowed types are md, txt, and markdown.",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "files": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "binary"
                    },
                    "description": "Files to upload (max 10MB each, up to 50 files)"
                  },
                  "folderPath": {
                    "type": "string",
                    "description": "Optional folder path"
                  },
                  "textDocuments": {
                    "type": "string",
                    "description": "JSON array of text documents with name and content"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Documents uploaded successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "documents": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "filename": {
                            "type": "string"
                          },
                          "folderPath": {
                            "type": "string"
                          },
                          "contentType": {
                            "type": "string"
                          },
                          "size": {
                            "type": "integer"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "List workspace documents",
        "description": "Returns all documents in a workspace, optionally filtered by folder",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "folder",
            "in": "query",
            "description": "Optional folder path to filter documents",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of documents",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "documents": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "filename": {
                            "type": "string"
                          },
                          "folderPath": {
                            "type": "string"
                          },
                          "contentType": {
                            "type": "string"
                          },
                          "size": {
                            "type": "integer"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "updatedAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/channels": {
      "post": {
        "summary": "Create workspace channel",
        "description": "Creates a new notification channel for a workspace",
        "tags": [
          "Channels"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "type",
                  "name",
                  "config"
                ],
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "discord",
                      "slack"
                    ],
                    "description": "Channel type"
                  },
                  "name": {
                    "type": "string",
                    "description": "Channel name"
                  },
                  "config": {
                    "type": "object",
                    "description": "Channel-specific configuration",
                    "properties": {
                      "botToken": {
                        "type": "string",
                        "description": "Discord bot token (required for discord type)"
                      },
                      "discordChannelId": {
                        "type": "string",
                        "description": "Discord channel ID (required for discord type)"
                      },
                      "webhookUrl": {
                        "type": "string",
                        "description": "Slack webhook URL (required for slack type)"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Channel created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "List workspace channels",
        "description": "Returns all notification channels in a workspace",
        "tags": [
          "Channels"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of channels",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "channels": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "type": {
                            "type": "string",
                            "description": "Channel type (e.g., discord, slack)"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "updatedAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents": {
      "post": {
        "summary": "Create a new agent",
        "description": "Creates a new AI agent in the workspace",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "systemPrompt"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Agent name"
                  },
                  "systemPrompt": {
                    "type": "string",
                    "description": "System prompt for the agent"
                  },
                  "modelName": {
                    "type": "string",
                    "nullable": true,
                    "description": "Model name (must be available in pricing config)"
                  },
                  "clientTools": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/ClientTool"
                    },
                    "description": "Client-side tools"
                  },
                  "avatar": {
                    "type": "string",
                    "nullable": true,
                    "description": "Avatar image path (e.g., \"/images/helpmaton_logo_10.svg\"). If not provided, a random avatar will be assigned."
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Agent created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "systemPrompt": {
                      "type": "string"
                    },
                    "provider": {
                      "type": "string"
                    },
                    "modelName": {
                      "type": "string",
                      "nullable": true
                    },
                    "clientTools": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/ClientTool"
                      }
                    },
                    "avatar": {
                      "type": "string",
                      "nullable": true
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "List workspace agents",
        "description": "Returns all agents in a workspace",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of agents",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AgentsResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/trial-credit-request": {
      "post": {
        "summary": "Request trial credits",
        "description": "Submits a request for trial credits for a workspace. Requires CAPTCHA validation (Cloudflare Turnstile token) and the user must be within the 7-day trial period from account creation. Only one request can be made per workspace. The request is sent to administrators for approval. Requires WRITE permission or higher.",
        "tags": [
          "Trial Credits"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "captchaToken"
                ],
                "properties": {
                  "captchaToken": {
                    "type": "string",
                    "description": "Cloudflare Turnstile CAPTCHA token"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Trial credit request submitted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Workspace not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/email-connection/test": {
      "post": {
        "summary": "Test workspace email connection",
        "description": "Sends a test email through the connection to verify configuration",
        "tags": [
          "Email"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Test email sent successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Email connection not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/channels/{channelId}/test": {
      "post": {
        "summary": "Test workspace channel",
        "description": "Sends a test notification through the channel to verify configuration",
        "tags": [
          "Channels"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "channelId",
            "in": "path",
            "required": true,
            "description": "Channel ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Test message sent successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Channel not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/test": {
      "post": {
        "summary": "Test agent with streaming response",
        "description": "Tests an agent by sending messages and receiving a streaming AI response. Handles credit validation, spending limits, and conversation logging.",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "messages"
                ],
                "properties": {
                  "messages": {
                    "type": "array",
                    "description": "Array of messages in ai-sdk UIMessage format",
                    "items": {
                      "type": "object",
                      "properties": {
                        "role": {
                          "type": "string",
                          "enum": [
                            "user",
                            "assistant",
                            "system",
                            "tool"
                          ]
                        },
                        "content": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Streaming response (Server-Sent Events format)",
            "content": {
              "text/event-stream": {
                "schema": {
                  "type": "string",
                  "description": "SSE stream with UI message chunks"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "402": {
            "description": "Insufficient credits",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "workspaceId": {
                      "type": "string"
                    },
                    "required": {
                      "type": "number"
                    },
                    "available": {
                      "type": "number"
                    },
                    "currency": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "429": {
            "description": "Spending limit exceeded",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    },
                    "failedLimits": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/mcp-servers": {
      "post": {
        "summary": "Create workspace MCP server",
        "description": "Creates a new MCP (Model Context Protocol) server for a workspace",
        "tags": [
          "MCP Servers"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "url",
                  "authType",
                  "config"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "MCP server name"
                  },
                  "url": {
                    "type": "string",
                    "format": "uri",
                    "description": "MCP server URL"
                  },
                  "authType": {
                    "type": "string",
                    "enum": [
                      "none",
                      "header",
                      "basic"
                    ],
                    "description": "Authentication type"
                  },
                  "config": {
                    "type": "object",
                    "description": "Authentication configuration",
                    "properties": {
                      "headerValue": {
                        "type": "string",
                        "description": "Header value (required for header auth)"
                      },
                      "username": {
                        "type": "string",
                        "description": "Username (required for basic auth)"
                      },
                      "password": {
                        "type": "string",
                        "description": "Password (required for basic auth)"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "MCP server created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "url": {
                      "type": "string"
                    },
                    "authType": {
                      "type": "string"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "List workspace MCP servers",
        "description": "Returns all MCP (Model Context Protocol) servers in a workspace",
        "tags": [
          "MCP Servers"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of MCP servers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "servers": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "name": {
                            "type": "string"
                          },
                          "url": {
                            "type": "string",
                            "description": "MCP server URL"
                          },
                          "authType": {
                            "type": "string",
                            "description": "Authentication type"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "updatedAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/generate-prompt": {
      "post": {
        "summary": "Generate system prompt for an agent",
        "description": "Generates a system prompt for an AI agent based on a user-provided goal and available tools",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GeneratePromptRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Generated system prompt",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/GeneratePromptResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found (when agentId is provided)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/spending-limits": {
      "post": {
        "summary": "Create agent spending limit",
        "description": "Creates a spending limit for a specific agent to control costs over a specific time period (daily, weekly, or monthly). Agent-level limits work in addition to workspace-level limits. When either limit is reached, operations will be blocked. Requires WRITE permission or higher.",
        "tags": [
          "Spending Limits"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "timeFrame",
                  "amount"
                ],
                "properties": {
                  "timeFrame": {
                    "type": "string",
                    "enum": [
                      "daily",
                      "weekly",
                      "monthly"
                    ],
                    "description": "Time period for the spending limit"
                  },
                  "amount": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Spending limit amount"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Agent with updated spending limits",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "systemPrompt": {
                      "type": "string"
                    },
                    "notificationChannelId": {
                      "type": "string",
                      "nullable": true
                    },
                    "spendingLimits": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/keys": {
      "post": {
        "summary": "Create agent key",
        "description": "Creates a new API key for an agent. The key value is only returned once upon creation.",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Optional name for the key"
                  },
                  "provider": {
                    "type": "string",
                    "description": "Provider for the key",
                    "default": "google"
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "webhook",
                      "widget"
                    ],
                    "description": "Key type - 'webhook' for webhook authentication, 'widget' for widget authentication",
                    "default": "webhook"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Agent key created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "key": {
                      "type": "string",
                      "description": "The API key value (only shown once)"
                    },
                    "name": {
                      "type": "string",
                      "nullable": true
                    },
                    "provider": {
                      "type": "string"
                    },
                    "type": {
                      "type": "string",
                      "enum": [
                        "webhook",
                        "widget"
                      ],
                      "description": "Key type"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "get": {
        "summary": "List agent keys",
        "description": "Returns all API keys for an agent",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of agent keys",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "keys": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "key": {
                            "type": "string",
                            "description": "The API key value (only shown when created)"
                          },
                          "name": {
                            "type": "string",
                            "nullable": true
                          },
                          "provider": {
                            "type": "string",
                            "default": "google"
                          },
                          "type": {
                            "type": "string",
                            "enum": [
                              "webhook",
                              "widget"
                            ],
                            "description": "Key type",
                            "default": "webhook"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/invites/{token}/accept": {
      "post": {
        "summary": "Accept workspace invite",
        "description": "Accepts a workspace invite using the invite token. Works for both authenticated and unauthenticated users. For authenticated users, immediately grants access to the workspace. For unauthenticated users, creates a new account and returns a callback URL for email verification. The invite must be valid and not expired. After acceptance, the user gains the permission level specified in the invite.",
        "tags": [
          "Workspace Invites"
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "token",
            "in": "path",
            "required": true,
            "description": "Invite token",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Invite accepted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "workspaceId": {
                      "type": "string"
                    },
                    "permissionLevel": {
                      "type": "integer"
                    },
                    "callbackUrl": {
                      "type": "string",
                      "nullable": true,
                      "description": "Email verification callback URL (only for unauthenticated users)"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "404": {
            "description": "Invite not found or expired",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/integrations/{integrationId}": {
      "patch": {
        "summary": "Update bot integration",
        "description": "Updates a bot integration (status, name, config)",
        "tags": [
          "Integrations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "get": {
        "summary": "Get bot integration",
        "description": "Gets a single bot integration",
        "tags": [
          "Integrations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "delete": {
        "summary": "Delete bot integration",
        "description": "Deletes a bot integration",
        "tags": [
          "Integrations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/api/workspaces/{workspaceId}/documents/{documentId}/rename": {
      "patch": {
        "summary": "Rename workspace document",
        "description": "Renames a document (updates filename in S3)",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "documentId",
            "in": "path",
            "required": true,
            "description": "Document ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "New document name"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Document renamed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "name": {
                      "type": "string"
                    },
                    "filename": {
                      "type": "string"
                    },
                    "folderPath": {
                      "type": "string"
                    },
                    "contentType": {
                      "type": "string"
                    },
                    "size": {
                      "type": "integer"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Document not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/user-limit": {
      "get": {
        "summary": "Get workspace user limit",
        "description": "Returns the current user count, maximum users allowed based on the workspace's subscription plan, plan name, and whether more users can be invited. Useful for checking if the workspace has reached its user limit before inviting new members. Requires READ permission or higher.",
        "tags": [
          "Workspace Members"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User limit information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "currentUserCount": {
                      "type": "integer",
                      "description": "Current number of users in workspace"
                    },
                    "maxUsers": {
                      "type": "integer",
                      "description": "Maximum users allowed by subscription plan"
                    },
                    "plan": {
                      "type": "string",
                      "description": "Subscription plan name"
                    },
                    "canInvite": {
                      "type": "boolean",
                      "description": "Whether more users can be invited"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/usage": {
      "get": {
        "summary": "Get workspace usage statistics",
        "description": "Returns usage statistics for a workspace",
        "tags": [
          "Usage"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "currency",
            "in": "query",
            "description": "Currency for cost calculations (always USD)",
            "schema": {
              "type": "string",
              "enum": [
                "usd"
              ],
              "default": "usd"
            }
          },
          {
            "name": "startDate",
            "in": "query",
            "description": "Start date for usage statistics (YYYY-MM-DD format)",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "endDate",
            "in": "query",
            "description": "End date for usage statistics (YYYY-MM-DD format). Defaults to today.",
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Workspace usage statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "workspaceId": {
                      "type": "string"
                    },
                    "currency": {
                      "type": "string",
                      "enum": [
                        "usd"
                      ]
                    },
                    "startDate": {
                      "type": "string",
                      "format": "date"
                    },
                    "endDate": {
                      "type": "string",
                      "format": "date"
                    },
                    "stats": {
                      "type": "object",
                      "properties": {
                        "inputTokens": {
                          "type": "integer"
                        },
                        "outputTokens": {
                          "type": "integer"
                        },
                        "totalTokens": {
                          "type": "integer"
                        },
                        "cost": {
                          "type": "number"
                        },
                        "byModel": {
                          "type": "array",
                          "items": {
                            "type": "object"
                          }
                        },
                        "byProvider": {
                          "type": "array",
                          "items": {
                            "type": "object"
                          }
                        },
                        "byByok": {
                          "type": "object"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/usage/daily": {
      "get": {
        "summary": "Get workspace daily usage statistics",
        "description": "Returns daily breakdown of usage statistics for a workspace",
        "tags": [
          "Usage"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "currency",
            "in": "query",
            "description": "Currency for cost calculations (always USD)",
            "schema": {
              "type": "string",
              "enum": [
                "usd"
              ],
              "default": "usd"
            }
          },
          {
            "name": "startDate",
            "in": "query",
            "description": "Start date (YYYY-MM-DD format)",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "endDate",
            "in": "query",
            "description": "End date (YYYY-MM-DD format). Defaults to today.",
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Daily usage statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "workspaceId": {
                      "type": "string"
                    },
                    "currency": {
                      "type": "string"
                    },
                    "startDate": {
                      "type": "string",
                      "format": "date"
                    },
                    "endDate": {
                      "type": "string",
                      "format": "date"
                    },
                    "daily": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "date": {
                            "type": "string",
                            "format": "date"
                          },
                          "inputTokens": {
                            "type": "integer"
                          },
                          "outputTokens": {
                            "type": "integer"
                          },
                          "totalTokens": {
                            "type": "integer"
                          },
                          "cost": {
                            "type": "number"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/transactions": {
      "get": {
        "summary": "List workspace transactions",
        "description": "Returns paginated list of credit transactions for a workspace, sorted by most recent first",
        "tags": [
          "Workspaces"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of transactions to return (1-100, default 50)",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 50
            }
          },
          {
            "name": "cursor",
            "in": "query",
            "description": "Pagination cursor from previous response",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of transactions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "transactions": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "workspaceId": {
                            "type": "string"
                          },
                          "agentId": {
                            "type": "string",
                            "nullable": true
                          },
                          "conversationId": {
                            "type": "string",
                            "nullable": true
                          },
                          "source": {
                            "type": "string",
                            "enum": [
                              "embedding-generation",
                              "text-generation",
                              "tool-execution"
                            ]
                          },
                          "supplier": {
                            "type": "string",
                            "enum": [
                              "openrouter",
                              "tavily"
                            ]
                          },
                          "model": {
                            "type": "string",
                            "nullable": true
                          },
                          "tool_call": {
                            "type": "string",
                            "nullable": true
                          },
                          "description": {
                            "type": "string"
                          },
                          "amountMillionthUsd": {
                            "type": "integer"
                          },
                          "workspaceCreditsBeforeMillionthUsd": {
                            "type": "integer"
                          },
                          "workspaceCreditsAfterMillionthUsd": {
                            "type": "integer"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    },
                    "nextCursor": {
                      "type": "string",
                      "nullable": true,
                      "description": "Cursor for next page of results"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "404": {
            "$ref": "#/components/responses/NotFound"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/invites": {
      "get": {
        "summary": "List workspace invites",
        "description": "Returns all pending (non-expired, non-accepted) invites for a workspace. Only shows invites that have not been accepted and have not expired. Includes invite ID, email, permission level, expiration date, and creation date. Requires OWNER permission.",
        "tags": [
          "Workspace Invites"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of pending invites",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "invites": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "inviteId": {
                            "type": "string"
                          },
                          "email": {
                            "type": "string"
                          },
                          "permissionLevel": {
                            "type": "integer",
                            "description": "Permission level (READ, WRITE, or OWNER)"
                          },
                          "expiresAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/invites/{token}": {
      "get": {
        "summary": "Get workspace invite",
        "description": "Returns invite details for a given token, including workspace name, email, permission level, inviter email, and expiration date. This endpoint does not require authentication and is typically used when a user clicks an invite link. Returns 404 if the invite is not found, expired, or already accepted.",
        "tags": [
          "Workspace Invites"
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "token",
            "in": "path",
            "required": true,
            "description": "Invite token",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Invite details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "workspaceId": {
                      "type": "string"
                    },
                    "workspaceName": {
                      "type": "string"
                    },
                    "email": {
                      "type": "string"
                    },
                    "permissionLevel": {
                      "type": "integer"
                    },
                    "inviterEmail": {
                      "type": "string",
                      "nullable": true
                    },
                    "expiresAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "404": {
            "description": "Invite not found or expired",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "410": {
            "description": "Workspace not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/email/oauth/{provider}/callback": {
      "get": {
        "summary": "Handle email OAuth callback",
        "description": "Handles OAuth callback from email provider and creates/updates email connection. Redirects to frontend on success.",
        "tags": [
          "Email"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "provider",
            "in": "path",
            "required": true,
            "description": "Email provider",
            "schema": {
              "type": "string",
              "enum": [
                "gmail",
                "outlook"
              ]
            }
          },
          {
            "name": "code",
            "in": "query",
            "description": "OAuth authorization code",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "state",
            "in": "query",
            "description": "OAuth state token",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "error",
            "in": "query",
            "description": "OAuth error (if authorization failed)",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "302": {
            "description": "Redirects to frontend success page"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/documents/search": {
      "get": {
        "summary": "Search workspace documents",
        "description": "Search documents in a workspace using semantic vector search. Returns the most relevant document snippets based on the query.",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "q",
            "in": "query",
            "required": true,
            "description": "Search query text",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of results (default: 5)",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 50,
              "default": 5
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Search results",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "snippet": {
                        "type": "string",
                        "description": "Document snippet content"
                      },
                      "documentName": {
                        "type": "string",
                        "description": "Name of the document"
                      },
                      "documentId": {
                        "type": "string",
                        "description": "ID of the document"
                      },
                      "folderPath": {
                        "type": "string",
                        "description": "Folder path of the document"
                      },
                      "similarity": {
                        "type": "number",
                        "description": "Similarity score (0-1)"
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/documents/folders": {
      "get": {
        "summary": "List document folders",
        "description": "Returns all unique folder paths in a workspace",
        "tags": [
          "Documents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of folder paths",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "folders": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Sorted list of unique folder paths"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/api-keys": {
      "get": {
        "summary": "Get all workspace API key statuses",
        "description": "Returns the API key status for all supported providers for a workspace. This is a boolean status check - the actual key values are never returned for security reasons. Requires READ permission or higher.",
        "tags": [
          "Workspace Settings"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "API key statuses for all providers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "keys": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "provider": {
                            "type": "string",
                            "enum": [
                              "openrouter"
                            ],
                            "description": "LLM provider name (only openrouter is supported for BYOK)"
                          },
                          "hasKey": {
                            "type": "boolean",
                            "description": "Whether workspace has an API key configured for this provider"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/user/api-keys": {
      "get": {
        "summary": "List user API keys",
        "description": "Returns all API keys for the authenticated user (masked)",
        "tags": [
          "User"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of API keys",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "API key ID"
                      },
                      "name": {
                        "type": "string",
                        "nullable": true,
                        "description": "Optional name/label for the key"
                      },
                      "keyPrefix": {
                        "type": "string",
                        "description": "Masked key prefix for display"
                      },
                      "maskedKey": {
                        "type": "string",
                        "description": "Fully masked key for display"
                      },
                      "createdAt": {
                        "type": "string",
                        "format": "date-time",
                        "description": "When the key was created"
                      },
                      "lastUsedAt": {
                        "type": "string",
                        "format": "date-time",
                        "nullable": true,
                        "description": "When the key was last used"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      },
      "post": {
        "summary": "Create user API key",
        "description": "Creates a new API key for the authenticated user. The key value is only returned once upon creation.",
        "tags": [
          "User"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Optional name/label for the key"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "API key created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "description": "API key ID"
                    },
                    "key": {
                      "type": "string",
                      "description": "The API key value (only shown once - save this securely)"
                    },
                    "name": {
                      "type": "string",
                      "nullable": true,
                      "description": "Optional name/label for the key"
                    },
                    "keyPrefix": {
                      "type": "string",
                      "description": "Key prefix for display"
                    },
                    "createdAt": {
                      "type": "string",
                      "format": "date-time",
                      "description": "When the key was created"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/trial-status": {
      "get": {
        "summary": "Get trial status",
        "description": "Returns comprehensive trial period status and credit usage information for a workspace, including whether the user is still in the trial period, days remaining, whether credits have been requested, approval status, initial credit amount, and current usage percentage. Useful for displaying trial information in the UI. Requires READ permission or higher.",
        "tags": [
          "Trial Credits"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Trial status information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "isInTrialPeriod": {
                      "type": "boolean"
                    },
                    "daysRemaining": {
                      "type": "integer"
                    },
                    "hasRequestedCredits": {
                      "type": "boolean"
                    },
                    "creditsApproved": {
                      "type": "boolean"
                    },
                    "initialCreditAmount": {
                      "type": "number"
                    },
                    "currentUsage": {
                      "type": "number",
                      "description": "Percentage of credits used (0-100)"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Workspace not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/email/oauth/{provider}/callback": {
      "get": {
        "summary": "Handle email OAuth callback (workspace-agnostic)",
        "description": "Handles OAuth callback from email provider. Extracts workspaceId from state token and creates/updates email connection. Redirects to frontend on success or error. Works for both authenticated and unauthenticated users (redirects to login if needed).",
        "tags": [
          "Email"
        ],
        "parameters": [
          {
            "name": "provider",
            "in": "path",
            "required": true,
            "description": "Email provider",
            "schema": {
              "type": "string",
              "enum": [
                "gmail",
                "outlook"
              ]
            }
          },
          {
            "name": "code",
            "in": "query",
            "description": "OAuth authorization code",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "state",
            "in": "query",
            "description": "OAuth state token (contains workspaceId)",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "error",
            "in": "query",
            "description": "OAuth error (if authorization failed)",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "302": {
            "description": "Redirects to frontend success/error page or login page"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/email/oauth/{provider}/authorize": {
      "get": {
        "summary": "Get email OAuth authorization URL",
        "description": "Returns the OAuth authorization URL for Gmail or Outlook email connection setup",
        "tags": [
          "Email"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "provider",
            "in": "path",
            "required": true,
            "description": "Email provider",
            "schema": {
              "type": "string",
              "enum": [
                "gmail",
                "outlook"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OAuth authorization URL",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "authUrl": {
                      "type": "string",
                      "format": "uri",
                      "description": "OAuth authorization URL to redirect user to"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/usage": {
      "get": {
        "summary": "Get agent usage statistics",
        "description": "Returns usage statistics for a specific agent",
        "tags": [
          "Agents",
          "Usage"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "currency",
            "in": "query",
            "description": "Currency for cost calculations (always USD)",
            "schema": {
              "type": "string",
              "enum": [
                "usd"
              ],
              "default": "usd"
            }
          },
          {
            "name": "startDate",
            "in": "query",
            "description": "Start date for usage statistics (YYYY-MM-DD format)",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "endDate",
            "in": "query",
            "description": "End date for usage statistics (YYYY-MM-DD format). Defaults to today.",
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Agent usage statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "workspaceId": {
                      "type": "string"
                    },
                    "agentId": {
                      "type": "string"
                    },
                    "currency": {
                      "type": "string",
                      "enum": [
                        "usd"
                      ]
                    },
                    "startDate": {
                      "type": "string",
                      "format": "date"
                    },
                    "endDate": {
                      "type": "string",
                      "format": "date"
                    },
                    "stats": {
                      "type": "object",
                      "properties": {
                        "inputTokens": {
                          "type": "integer"
                        },
                        "outputTokens": {
                          "type": "integer"
                        },
                        "totalTokens": {
                          "type": "integer"
                        },
                        "cost": {
                          "type": "number"
                        },
                        "byModel": {
                          "type": "array",
                          "items": {
                            "type": "object"
                          }
                        },
                        "byProvider": {
                          "type": "array",
                          "items": {
                            "type": "object"
                          }
                        },
                        "byByok": {
                          "type": "object"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/usage/daily": {
      "get": {
        "summary": "Get agent daily usage statistics",
        "description": "Returns daily breakdown of usage statistics for an agent",
        "tags": [
          "Agents",
          "Usage"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "currency",
            "in": "query",
            "description": "Currency for cost calculations (always USD)",
            "schema": {
              "type": "string",
              "enum": [
                "usd"
              ],
              "default": "usd"
            }
          },
          {
            "name": "startDate",
            "in": "query",
            "description": "Start date (YYYY-MM-DD format)",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "endDate",
            "in": "query",
            "description": "End date (YYYY-MM-DD format). Defaults to today.",
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Daily usage statistics",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "workspaceId": {
                      "type": "string"
                    },
                    "agentId": {
                      "type": "string"
                    },
                    "currency": {
                      "type": "string"
                    },
                    "startDate": {
                      "type": "string",
                      "format": "date"
                    },
                    "endDate": {
                      "type": "string",
                      "format": "date"
                    },
                    "daily": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "date": {
                            "type": "string",
                            "format": "date"
                          },
                          "inputTokens": {
                            "type": "integer"
                          },
                          "outputTokens": {
                            "type": "integer"
                          },
                          "totalTokens": {
                            "type": "integer"
                          },
                          "cost": {
                            "type": "number"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/transactions": {
      "get": {
        "summary": "List agent transactions",
        "description": "Returns paginated list of credit transactions for an agent, sorted by most recent first",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of transactions to return (1-100, default 50)",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 50
            }
          },
          {
            "name": "cursor",
            "in": "query",
            "description": "Pagination cursor from previous response",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of transactions",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "transactions": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "workspaceId": {
                            "type": "string"
                          },
                          "agentId": {
                            "type": "string",
                            "nullable": true
                          },
                          "conversationId": {
                            "type": "string",
                            "nullable": true
                          },
                          "source": {
                            "type": "string",
                            "enum": [
                              "embedding-generation",
                              "text-generation",
                              "tool-execution"
                            ]
                          },
                          "supplier": {
                            "type": "string",
                            "enum": [
                              "openrouter",
                              "tavily"
                            ]
                          },
                          "model": {
                            "type": "string",
                            "nullable": true
                          },
                          "tool_call": {
                            "type": "string",
                            "nullable": true
                          },
                          "description": {
                            "type": "string"
                          },
                          "amountMillionthUsd": {
                            "type": "integer"
                          },
                          "workspaceCreditsBeforeMillionthUsd": {
                            "type": "integer"
                          },
                          "workspaceCreditsAfterMillionthUsd": {
                            "type": "integer"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    },
                    "nextCursor": {
                      "type": "string",
                      "nullable": true,
                      "description": "Cursor for next page of results"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/memory": {
      "get": {
        "summary": "Get agent memory records",
        "description": "Returns memory records for a specific agent, with optional semantic search and temporal filtering",
        "tags": [
          "Agents",
          "Memory"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "grain",
            "in": "query",
            "description": "Temporal grain to search (working, daily, weekly, monthly, quarterly, yearly)",
            "schema": {
              "type": "string",
              "enum": [
                "working",
                "daily",
                "weekly",
                "monthly",
                "quarterly",
                "yearly"
              ],
              "default": "working"
            }
          },
          {
            "name": "queryText",
            "in": "query",
            "description": "Optional semantic search query. If empty, only temporal filtering is applied.",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "minimumDaysAgo",
            "in": "query",
            "description": "Minimum age of results in days (default: 0)",
            "schema": {
              "type": "integer",
              "default": 0
            }
          },
          {
            "name": "maximumDaysAgo",
            "in": "query",
            "description": "Maximum age of results in days (default: 365)",
            "schema": {
              "type": "integer",
              "default": 365
            }
          },
          {
            "name": "maxResults",
            "in": "query",
            "description": "Maximum number of results to return (default: 50)",
            "schema": {
              "type": "integer",
              "default": 50
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Agent memory records",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "workspaceId": {
                      "type": "string"
                    },
                    "agentId": {
                      "type": "string"
                    },
                    "records": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "content": {
                            "type": "string"
                          },
                          "date": {
                            "type": "string"
                          },
                          "timestamp": {
                            "type": "string"
                          },
                          "metadata": {
                            "type": "object"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/conversations": {
      "get": {
        "summary": "List agent conversations",
        "description": "Returns paginated list of conversations for an agent, sorted by most recent first",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of conversations to return (1-100, default 50)",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 50
            }
          },
          {
            "name": "cursor",
            "in": "query",
            "description": "Pagination cursor from previous response",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of conversations",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "conversations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "conversationType": {
                            "type": "string"
                          },
                          "startedAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "lastMessageAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "messageCount": {
                            "type": "integer"
                          },
                          "tokenUsage": {
                            "type": "object",
                            "nullable": true
                          }
                        }
                      }
                    },
                    "nextCursor": {
                      "type": "string",
                      "nullable": true,
                      "description": "Cursor for next page of results"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/conversations/{conversationId}": {
      "get": {
        "summary": "Get agent conversation",
        "description": "Returns full details of a specific conversation including messages, tool calls, and results",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "conversationId",
            "in": "path",
            "required": true,
            "description": "Conversation ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Conversation details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "conversationType": {
                      "type": "string"
                    },
                    "messages": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    },
                    "tokenUsage": {
                      "type": "object",
                      "nullable": true
                    },
                    "startedAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "lastMessageAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "delegations": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "callingAgentId": {
                            "type": "string"
                          },
                          "targetAgentId": {
                            "type": "string"
                          },
                          "taskId": {
                            "type": "string",
                            "nullable": true
                          },
                          "timestamp": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "status": {
                            "type": "string",
                            "enum": [
                              "completed",
                              "failed",
                              "cancelled"
                            ]
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent or conversation not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/invites/{inviteId}": {
      "delete": {
        "summary": "Delete workspace invite",
        "description": "Permanently deletes a workspace invite, preventing it from being accepted. This is useful for revoking invites that are no longer needed. The invite cannot be recovered after deletion. Requires OWNER permission.",
        "tags": [
          "Workspace Invites"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "inviteId",
            "in": "path",
            "required": true,
            "description": "Invite ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Invite deleted successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/user/api-keys/{keyId}": {
      "delete": {
        "summary": "Delete user API key",
        "description": "Deletes an API key for the authenticated user",
        "tags": [
          "User"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "keyId",
            "in": "path",
            "required": true,
            "description": "API key ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "API key deleted successfully"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "API key not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/workspaces/{workspaceId}/agents/{agentId}/keys/{keyId}": {
      "delete": {
        "summary": "Delete agent key",
        "description": "Deletes an API key for an agent",
        "tags": [
          "Agents"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "workspaceId",
            "in": "path",
            "required": true,
            "description": "Workspace ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "agentId",
            "in": "path",
            "required": true,
            "description": "Agent ID",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "keyId",
            "in": "path",
            "required": true,
            "description": "Key ID",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Agent key deleted successfully"
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "$ref": "#/components/responses/Forbidden"
          },
          "410": {
            "description": "Agent or key not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/user/refresh-token": {
      "post": {
        "summary": "Refresh access and refresh tokens",
        "description": "Validates a refresh token and returns new access and refresh tokens. The old refresh token is revoked. This endpoint does not require authentication as it uses the refresh token in the request body.",
        "tags": [
          "User"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refreshToken"
                ],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "description": "The refresh token to validate"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Tokens refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string",
                      "description": "New JWT access token (24 hours expiry)"
                    },
                    "refreshToken": {
                      "type": "string",
                      "description": "New refresh token (30 days expiry, save securely)"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/user/generate-tokens": {
      "post": {
        "summary": "Generate access and refresh tokens",
        "description": "Generates new access and refresh tokens for the authenticated user. Requires either a valid Bearer token or cookie-based session. This is typically called after initial login to get Bearer tokens.",
        "tags": [
          "User"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Tokens generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string",
                      "description": "JWT access token (24 hours expiry)"
                    },
                    "refreshToken": {
                      "type": "string",
                      "description": "Refresh token (30 days expiry, save securely)"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/usage": {
      "get": {
        "summary": "Get usage statistics",
        "description": "Returns aggregated usage statistics across all workspaces the authenticated user has access to",
        "tags": [
          "Usage"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "currency",
            "in": "query",
            "description": "Currency for cost calculations",
            "schema": {
              "type": "string",
              "enum": [
                "usd",
                "eur",
                "gbp"
              ],
              "default": "usd"
            }
          },
          {
            "name": "startDate",
            "in": "query",
            "description": "Start date for usage statistics (YYYY-MM-DD format)",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "endDate",
            "in": "query",
            "description": "End date for usage statistics (YYYY-MM-DD format). Defaults to today.",
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Usage statistics",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UsageResponse"
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/stream-url": {
      "get": {
        "summary": "Get streaming function URL",
        "description": "Returns the Lambda Function URL for streaming agent interactions",
        "tags": [
          "Streaming"
        ],
        "responses": {
          "200": {
            "description": "Streaming function URL",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "url": {
                      "type": "string",
                      "description": "The Lambda Function URL for streaming"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Streaming function URL not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "406": {
            "description": "Method not allowed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/pricing": {
      "get": {
        "summary": "Get OpenRouter model pricing",
        "description": "Returns pricing information for all available OpenRouter AI models",
        "tags": [
          "Usage"
        ],
        "responses": {
          "200": {
            "description": "OpenRouter model pricing",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "openrouter": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "object",
                        "properties": {
                          "input": {
                            "type": "number",
                            "description": "Price per 1M input tokens (USD)"
                          },
                          "output": {
                            "type": "number",
                            "description": "Price per 1M output tokens (USD)"
                          },
                          "cachedInput": {
                            "type": "number",
                            "description": "Price per 1M cached input tokens (USD, optional)"
                          },
                          "tiers": {
                            "type": "array",
                            "description": "Tiered pricing structure (optional)"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    },
    "/api/models": {
      "get": {
        "summary": "Get available models",
        "description": "Returns a list of available OpenRouter AI models and their default model",
        "tags": [
          "Usage"
        ],
        "responses": {
          "200": {
            "description": "Available OpenRouter models",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ModelsResponse"
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/InternalServerError"
          }
        }
      }
    }
  }
}